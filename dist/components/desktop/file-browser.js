var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var common_1 = require('angular2/common');
var desktop_1 = require('../../desktop/desktop/desktop');
var taskbar_1 = require('../../desktop/taskbar/taskbar');
var file_browser_1 = require('../../desktop/application/file-browser');
var photo_browser_1 = require('../../desktop/application/photo-browser');
var terminal_1 = require('../../desktop/application/terminal');
var video_player_1 = require('../../desktop/application/video-player');
var dock_1 = require('../../desktop/taskbar/dock');
var menu_1 = require('../../desktop/menu/menu');
var http_1 = require('angular2/http');
var FileBrowserAppCmp = (function () {
    function FileBrowserAppCmp(http) {
        var _this = this;
        this.http = http;
        this._id = 'desktop';
        this.backgroundImage = '/resource/images/img1.jpg';
        this.fileBrowsers = [];
        this.photoBrowsers = [];
        this.videoPlayer = [];
        this.menus = menu_1.menuList;
        this.terminals = [];
        this.shortcuts = [];
        this.docks = [];
        this.idIndex = 0;
        this.iconMap = {
            'inode/directory': 'icon-folder',
            'text/plain': 'icon-textfile',
            'image/png': 'icon-image',
            'image/jpeg': 'icon-image',
            'application/ogg': 'icon-video'
        };
        this.createApp('menu', this.menus, {
            top: 100,
            left: 100,
            items: [{
                    text: "新建",
                    items: [{
                            text: "文件夹",
                            handler: function () {
                                alert('wenjianjia');
                            }
                        }, {
                            text: "文本",
                            handler: function () {
                            }
                        }],
                    handler: function (event) {
                        alert(1);
                    }
                }, {
                    text: "New File2",
                    handler: function (event) {
                        alert(2);
                    }
                }, {
                    text: "New File3",
                    handler: function (event) {
                        alert(3);
                    }
                }]
        });
        this.shortcuts = [{
                icon: 'icon-computer',
                text: '这台电脑',
                shadow: 'shadow',
                dblclick: function () {
                    var config = {
                        title: '这台电脑',
                        path: '/'
                    };
                    _this.createApp('file-browser', _this.fileBrowsers, _this.getFileBrowserConfig(config));
                }
            }, {
                icon: 'icon-user',
                text: '我的文档',
                shadow: 'shadow',
                dblclick: function () {
                    var config = {
                        title: '我的文档',
                        path: '/root'
                    };
                    _this.createApp('file-browser', _this.fileBrowsers, _this.getFileBrowserConfig(config));
                }
            }, {
                icon: 'icon-terminal',
                text: 'Terminal',
                shadow: 'shadow',
                dblclick: function () {
                    _this.createApp('terminal', _this.terminals, { icon_class: 'icon-terminal' });
                }
            }];
    }
    FileBrowserAppCmp.prototype.createApp = function (type, list, config) {
        if (config === void 0) { config = {}; }
        var id = type + '-' + this.idIndex++;
        list.push(_.extend(config, {
            _id: id,
            type: type,
            componentList: list
        }));
        var isFind = false;
        dock_1.dockAppList.forEach(function (item, index) {
            if (item._id === type)
                isFind = true;
        });
        if (!isFind)
            dock_1.dockAppList.push({ _id: type, items: list, icon: 'task-icon-' + type });
    };
    FileBrowserAppCmp.prototype.lsByPath = function (path, done) {
        var res = this.http.get('/ls/ubuntu?path=' + path);
        res.subscribe(function (res) {
            console.log(111);
            if (res.status !== 200)
                return alert('error');
            var list = res.json();
            done(null, list);
        });
    };
    FileBrowserAppCmp.prototype.getFileBrowserConfig = function (_config) {
        var _this = this;
        if (_config === void 0) { _config = {}; }
        var config = _.extend({
            onSetPath: function (path) {
                _this.lsByPath(path, function (err, list) {
                    list.forEach(function (item) {
                        item.text = item.name;
                        item.icon = _this.iconMap[item.type];
                        if (!item.icon)
                            item.icon = 'icon-file';
                        if (item.type === 'inode/directory') {
                            item.dblclick = function () {
                                config['object']['setPath']((path === '/' ? '' : path) + '/' + item.name);
                            };
                        }
                        if (/image\/*/.test(item.type)) {
                            item.dblclick = function () {
                                _this.createApp('photo-browser', _this.photoBrowsers, { title: item.name, url: '/getFile?url=' + item.path + '&type=' + item.type });
                            };
                        }
                        if (item.type === 'application/ogg') {
                            item.dblclick = function () {
                                _this.createApp('video-player', _this.videoPlayer, { url: 'http://127.0.0.1:8088/getFile?url=' + item.path + '&type=video/ogg' });
                            };
                        }
                    });
                    config.fileList = list;
                });
            },
            fileList: []
        }, _config);
        return config;
    };
    FileBrowserAppCmp = __decorate([
        core_1.Component({
            selector: 'file-browser-app',
            template: "\n        <file-browser *ngFor=\"#item of fileBrowsers\" [config]=\"item\" ></file-browser>\n    ",
            directives: [common_1.NgFor, desktop_1.DesktopCmp, taskbar_1.TaskbarCmp, file_browser_1.FileBrowserCmp, photo_browser_1.PhotoBrowserCmp, terminal_1.TerminalCmp, video_player_1.VideoPlayerCmp, menu_1.MenuCmp],
            viewProviders: [http_1.HTTP_PROVIDERS],
        }), 
        __metadata('design:paramtypes', [http_1.Http])
    ], FileBrowserAppCmp);
    return FileBrowserAppCmp;
})();
exports.FileBrowserAppCmp = FileBrowserAppCmp;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvZGVza3RvcC9maWxlLWJyb3dzZXIudHMiXSwibmFtZXMiOlsiRmlsZUJyb3dzZXJBcHBDbXAiLCJGaWxlQnJvd3NlckFwcENtcC5jb25zdHJ1Y3RvciIsIkZpbGVCcm93c2VyQXBwQ21wLmNyZWF0ZUFwcCIsIkZpbGVCcm93c2VyQXBwQ21wLmxzQnlQYXRoIiwiRmlsZUJyb3dzZXJBcHBDbXAuZ2V0RmlsZUJyb3dzZXJDb25maWciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHFCQUEwQixlQUFlLENBQUMsQ0FBQTtBQUMxQyx1QkFBK0IsaUJBQWlCLENBQUMsQ0FBQTtBQUNqRCx3QkFBMkIsK0JBQStCLENBQUMsQ0FBQTtBQUMzRCx3QkFBMkIsK0JBQStCLENBQUMsQ0FBQTtBQUMzRCw2QkFBK0Isd0NBQXdDLENBQUMsQ0FBQTtBQUN4RSw4QkFBZ0MseUNBQXlDLENBQUMsQ0FBQTtBQUMxRSx5QkFBNEIsb0NBQW9DLENBQUMsQ0FBQTtBQUNqRSw2QkFBK0Isd0NBQXdDLENBQUMsQ0FBQTtBQUN4RSxxQkFBNEIsNEJBQTRCLENBQUMsQ0FBQTtBQUN6RCxxQkFBa0MseUJBQXlCLENBQUMsQ0FBQTtBQUc1RCxxQkFBNkMsZUFBZSxDQUFDLENBQUE7QUFJN0Q7SUE2R0lBLDJCQUFtQkEsSUFBV0E7UUE3R2xDQyxpQkFtTENBO1FBdEVzQkEsU0FBSUEsR0FBSkEsSUFBSUEsQ0FBT0E7UUFuRzlCQSxRQUFHQSxHQUFHQSxTQUFTQSxDQUFBQTtRQUNmQSxvQkFBZUEsR0FBR0EsMkJBQTJCQSxDQUFBQTtRQUM3Q0EsaUJBQVlBLEdBQUdBLEVBQUVBLENBQUFBO1FBQ2pCQSxrQkFBYUEsR0FBR0EsRUFBRUEsQ0FBQUE7UUFDbEJBLGdCQUFXQSxHQUFHQSxFQUFFQSxDQUFBQTtRQUNoQkEsVUFBS0EsR0FBR0EsZUFBUUEsQ0FBQUE7UUFDaEJBLGNBQVNBLEdBQUdBLEVBQUVBLENBQUFBO1FBQ2RBLGNBQVNBLEdBQUdBLEVBQUVBLENBQUFBO1FB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QUNBO29CQU9MQSxDQUFDQSxDQUFDQSxDQUFBQTtvQkFFRkEsTUFBTUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQUE7Z0JBQzFCQSxDQUFDQSxDQUFDQSxDQUFBQTtZQUNOQSxDQUFDQTtZQUNEQSxRQUFRQSxFQUFFQSxFQUFFQTtTQUNmQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFBQTtRQUVYQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFBQTtJQUNqQkEsQ0FBQ0E7SUEzR0xKO1FBQUNBLGdCQUFTQSxDQUFDQTtZQUNQQSxRQUFRQSxFQUFFQSxrQkFBa0JBO1lBQzVCQSxRQUFRQSxFQUFFQSxtR0FFVEE7WUFDREEsVUFBVUEsRUFBRUEsQ0FBQ0EsY0FBS0EsRUFBRUEsb0JBQVVBLEVBQUVBLG9CQUFVQSxFQUFFQSw2QkFBY0EsRUFBRUEsK0JBQWVBLEVBQUVBLHNCQUFXQSxFQUFDQSw2QkFBY0EsRUFBRUEsY0FBT0EsQ0FBQ0E7WUFDakhBLGFBQWFBLEVBQUVBLENBQUNBLHFCQUFjQSxDQUFDQTtTQUNsQ0EsQ0FBQ0E7OzBCQTRLREE7SUFBREEsd0JBQUNBO0FBQURBLENBbkxBLEFBbUxDQSxJQUFBO0FBMUtZLHlCQUFpQixvQkEwSzdCLENBQUEiLCJmaWxlIjoiY29tcG9uZW50cy9kZXNrdG9wL2ZpbGUtYnJvd3Nlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ2FuZ3VsYXIyL2NvcmUnO1xuaW1wb3J0IHsgTmdTdHlsZSwgTmdGb3IgfSBmcm9tICdhbmd1bGFyMi9jb21tb24nO1xuaW1wb3J0IHsgRGVza3RvcENtcCB9IGZyb20gJy4uLy4uL2Rlc2t0b3AvZGVza3RvcC9kZXNrdG9wJztcbmltcG9ydCB7IFRhc2tiYXJDbXAgfSBmcm9tICcuLi8uLi9kZXNrdG9wL3Rhc2tiYXIvdGFza2Jhcic7XG5pbXBvcnQgeyBGaWxlQnJvd3NlckNtcCB9IGZyb20gJy4uLy4uL2Rlc2t0b3AvYXBwbGljYXRpb24vZmlsZS1icm93c2VyJztcbmltcG9ydCB7IFBob3RvQnJvd3NlckNtcCB9IGZyb20gJy4uLy4uL2Rlc2t0b3AvYXBwbGljYXRpb24vcGhvdG8tYnJvd3Nlcic7XG5pbXBvcnQgeyBUZXJtaW5hbENtcCB9IGZyb20gJy4uLy4uL2Rlc2t0b3AvYXBwbGljYXRpb24vdGVybWluYWwnO1xuaW1wb3J0IHsgVmlkZW9QbGF5ZXJDbXAgfSBmcm9tICcuLi8uLi9kZXNrdG9wL2FwcGxpY2F0aW9uL3ZpZGVvLXBsYXllcic7XG5pbXBvcnQgeyBkb2NrQXBwTGlzdCB9IGZyb20gJy4uLy4uL2Rlc2t0b3AvdGFza2Jhci9kb2NrJztcbmltcG9ydCB7IE1lbnVDbXAgLCBtZW51TGlzdH0gZnJvbSAnLi4vLi4vZGVza3RvcC9tZW51L21lbnUnO1xuaW1wb3J0IHsgYm9vdHN0cmFwIH0gICAgZnJvbSAnYW5ndWxhcjIvcGxhdGZvcm0vYnJvd3NlcidcbmltcG9ydCB7IEluamVjdG9yLCBwcm92aWRlIH0gZnJvbSAnYW5ndWxhcjIvY29yZSc7XG5pbXBvcnQgeyBIdHRwLCBIVFRQX1BST1ZJREVSUywgSGVhZGVyc30gZnJvbSAnYW5ndWxhcjIvaHR0cCc7XG5cbmRlY2xhcmUgdmFyICQsIF9cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdmaWxlLWJyb3dzZXItYXBwJyxcbiAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8ZmlsZS1icm93c2VyICpuZ0Zvcj1cIiNpdGVtIG9mIGZpbGVCcm93c2Vyc1wiIFtjb25maWddPVwiaXRlbVwiID48L2ZpbGUtYnJvd3Nlcj5cbiAgICBgLFxuICAgIGRpcmVjdGl2ZXM6IFtOZ0ZvciwgRGVza3RvcENtcCwgVGFza2JhckNtcCwgRmlsZUJyb3dzZXJDbXAsIFBob3RvQnJvd3NlckNtcCwgVGVybWluYWxDbXAsVmlkZW9QbGF5ZXJDbXAsIE1lbnVDbXBdLFxuICAgIHZpZXdQcm92aWRlcnM6IFtIVFRQX1BST1ZJREVSU10sXG59KVxuXG5leHBvcnQgY2xhc3MgRmlsZUJyb3dzZXJBcHBDbXAge1xuICAgIF9pZCA9ICdkZXNrdG9wJ1xuICAgIGJhY2tncm91bmRJbWFnZSA9ICcvcmVzb3VyY2UvaW1hZ2VzL2ltZzEuanBnJ1xuICAgIGZpbGVCcm93c2VycyA9IFtdXG4gICAgcGhvdG9Ccm93c2VycyA9IFtdXG4gICAgdmlkZW9QbGF5ZXIgPSBbXVxuICAgIG1lbnVzID0gbWVudUxpc3RcbiAgICB0ZXJtaW5hbHMgPSBbXVxuICAgIHNob3J0Y3V0cyA9IFtdXG4gICAgZG9ja3MgPSBbXVxuICAgIGlkSW5kZXggPSAwXG4gICAgY3JlYXRlQXBwKHR5cGUsIGxpc3QsIGNvbmZpZz17fSlcbiAgICB7XG4gICAgICAgIHZhciBpZCA9IHR5cGUgKyAnLScgKyB0aGlzLmlkSW5kZXggKysgXG4gICAgICAgIGxpc3QucHVzaChfLmV4dGVuZChjb25maWcse1xuICAgICAgICAgICAgX2lkOiBpZCxcbiAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICBjb21wb25lbnRMaXN0OiBsaXN0XG4gICAgICAgIH0pKVxuICAgICAgICBcbiAgICAgICAgdmFyIGlzRmluZCA9IGZhbHNlIFxuICAgICAgICBkb2NrQXBwTGlzdC5mb3JFYWNoKChpdGVtLCBpbmRleCk9PntcbiAgICAgICAgICAgIGlmKCBpdGVtLl9pZCA9PT0gdHlwZSApXG4gICAgICAgICAgICAgICAgaXNGaW5kID0gdHJ1ZVxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgaWYoICFpc0ZpbmQgKVxuICAgICAgICAgICAgZG9ja0FwcExpc3QucHVzaCh7X2lkOiB0eXBlLCBpdGVtczogbGlzdCwgaWNvbjogJ3Rhc2staWNvbi0nK3R5cGUgfSlcbiAgICB9XG4gICAgXG4gICAgbHNCeVBhdGgocGF0aCwgZG9uZSl7XG4gICAgICAgIHZhciByZXMgPSB0aGlzLmh0dHAuZ2V0KCcvbHMvdWJ1bnR1P3BhdGg9JytwYXRoKVxuICAgICAgICBcbiAgICAgICAgcmVzLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coMTExKVxuICAgICAgICAgICAgaWYoIHJlcy5zdGF0dXMgIT09IDIwMCApXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFsZXJ0KCdlcnJvcicpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgbGlzdCA9IHJlcy5qc29uKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZG9uZShudWxsLCBsaXN0KVxuICAgICAgICB9KVxuICAgIH1cbiAgICBcbiAgICBpY29uTWFwID0ge1xuICAgICAgICAnaW5vZGUvZGlyZWN0b3J5JzogJ2ljb24tZm9sZGVyJyxcbiAgICAgICAgJ3RleHQvcGxhaW4nOiAnaWNvbi10ZXh0ZmlsZScsXG4gICAgICAgICdpbWFnZS9wbmcnOiAnaWNvbi1pbWFnZScsXG4gICAgICAgICdpbWFnZS9qcGVnJzogJ2ljb24taW1hZ2UnLFxuICAgICAgICAnYXBwbGljYXRpb24vb2dnJzogJ2ljb24tdmlkZW8nXG4gICAgfVxuICAgIFxuICAgIGdldEZpbGVCcm93c2VyQ29uZmlnKF9jb25maWcgPSB7fSlcbiAgICB7XG4gICAgICAgIHZhciBjb25maWcgPSBfLmV4dGVuZChcbiAgICAgICAge1xuICAgICAgICAgICAgb25TZXRQYXRoOiAocGF0aCk9PntcbiAgICAgICAgICAgICAgICB0aGlzLmxzQnlQYXRoKHBhdGgsIChlcnIsIGxpc3QpPT57XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuZm9yRWFjaCggKGl0ZW0pPT5cbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS50ZXh0ID0gaXRlbS5uYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmljb24gPSB0aGlzLmljb25NYXBbaXRlbS50eXBlXVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggIWl0ZW0uaWNvbiApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5pY29uID0gJ2ljb24tZmlsZSdcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIGl0ZW0udHlwZSA9PT0gJ2lub2RlL2RpcmVjdG9yeScgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRibGNsaWNrID0gKCk9PntcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnWydvYmplY3QnXVsnc2V0UGF0aCddKChwYXRoID09PSAnLyc/Jyc6cGF0aCkgKyAnLycgKyBpdGVtLm5hbWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggL2ltYWdlXFwvKi8udGVzdChpdGVtLnR5cGUpICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYmxjbGljayA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQXBwKCdwaG90by1icm93c2VyJywgdGhpcy5waG90b0Jyb3dzZXJzLCB7IHRpdGxlOiBpdGVtLm5hbWUsIHVybDogJy9nZXRGaWxlP3VybD0nK2l0ZW0ucGF0aCsnJnR5cGU9JytpdGVtLnR5cGUgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBpdGVtLnR5cGUgPT09ICdhcHBsaWNhdGlvbi9vZ2cnICl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kYmxjbGljayA9ICgpPT57XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQXBwKCd2aWRlby1wbGF5ZXInLCB0aGlzLnZpZGVvUGxheWVyLCB7IHVybDogJ2h0dHA6Ly8xMjcuMC4wLjE6ODA4OC9nZXRGaWxlP3VybD0nK2l0ZW0ucGF0aCsnJnR5cGU9dmlkZW8vb2dnJyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBpZiggaXRlbS50eXBlID09PSAnZmlsZScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGl0ZW0uaWNvbiA9ICdpY29uLXRleHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIGlmKCBpdGVtLnR5cGUgPT09ICdpbWFnZScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgIGl0ZW0uaWNvbiA9ICdpY29uLWltYWdlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5maWxlTGlzdCA9IGxpc3RcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZpbGVMaXN0OiBbXVxuICAgICAgICB9LCBfY29uZmlnKVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGNvbmZpZ1xuICAgIH1cbiAgICBcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgaHR0cD86IEh0dHApe1xuICAgICAgICBcbiAgICAgICAgdGhpcy5jcmVhdGVBcHAoJ21lbnUnLCB0aGlzLm1lbnVzLCB7XG4gICAgICAgICAgICB0b3A6IDEwMCxcbiAgICAgICAgICAgIGxlZnQ6IDEwMCxcbiAgICAgICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRleHQ6IFwi5paw5bu6XCIsXG4gICAgICAgICAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwi5paH5Lu25aS5XCIsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgnd2VuamlhbmppYScpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IFwi5paH5pysXCIsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1dLFxuICAgICAgICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoMSkgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHRleHQ6IFwiTmV3IEZpbGUyXCIsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oZXZlbnQpIFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoMikgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHRleHQ6IFwiTmV3IEZpbGUzXCIsXG4gICAgICAgICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24oZXZlbnQpIFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWxlcnQoMykgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfV1cbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc2hvcnRjdXRzID0gW3tcbiAgICAgICAgICAgIGljb246ICdpY29uLWNvbXB1dGVyJyxcbiAgICAgICAgICAgIHRleHQ6ICfov5nlj7DnlLXohJEnLFxuICAgICAgICAgICAgc2hhZG93OiAnc2hhZG93JyxcbiAgICAgICAgICAgIGRibGNsaWNrOiAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn6L+Z5Y+w55S16ISRJyxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogJy8nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQXBwKCdmaWxlLWJyb3dzZXInLCB0aGlzLmZpbGVCcm93c2VycywgdGhpcy5nZXRGaWxlQnJvd3NlckNvbmZpZyhjb25maWcpKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICBpY29uOiAnaWNvbi11c2VyJywgXG4gICAgICAgICAgICB0ZXh0OiAn5oiR55qE5paH5qGjJyxcbiAgICAgICAgICAgIHNoYWRvdzogJ3NoYWRvdycsXG4gICAgICAgICAgICBkYmxjbGljazooKT0+e1xuICAgICAgICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5oiR55qE5paH5qGjJyxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogJy9yb290J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUFwcCgnZmlsZS1icm93c2VyJywgdGhpcy5maWxlQnJvd3NlcnMsIHRoaXMuZ2V0RmlsZUJyb3dzZXJDb25maWcoY29uZmlnKSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgICAgaWNvbjogJ2ljb24tdGVybWluYWwnLFxuICAgICAgICAgICAgdGV4dDogJ1Rlcm1pbmFsJyxcbiAgICAgICAgICAgIHNoYWRvdzogJ3NoYWRvdycsXG4gICAgICAgICAgICBkYmxjbGljazogKCk9PntcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUFwcCgndGVybWluYWwnLCB0aGlzLnRlcm1pbmFscywgeyBpY29uX2NsYXNzOiAnaWNvbi10ZXJtaW5hbCd9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9XVxuICAgIH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==